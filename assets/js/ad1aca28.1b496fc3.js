"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[834],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),u=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=u(t),d=a,b=m["".concat(s,".").concat(d)]||m[d]||c[d]||o;return t?r.createElement(b,i(i({ref:n},p),{},{components:t})):r.createElement(b,i({ref:n},p))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=t[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2063:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return p},default:function(){return m}});var r=t(7462),a=t(3366),o=(t(7294),t(3905)),i=["components"],l={sidebar_position:3},s="Ensemble with NumerBay",u={unversionedId:"tutorial-extras/ensemble",id:"tutorial-extras/ensemble",title:"Ensemble with NumerBay",description:"In this tutorial we are going to make a simple ensemble Numerai predictions file from predictions bought on NumerBay.",source:"@site/docs/tutorial-extras/ensemble.md",sourceDirName:"tutorial-extras",slug:"/tutorial-extras/ensemble",permalink:"/docs/tutorial-extras/ensemble",editUrl:"https://github.com/councilofelders/numerbay/tree/master/docs/docs/tutorial-extras/ensemble.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Automate Submissions (seller)",permalink:"/docs/tutorial-extras/api-automation"},next:{title:"Changelog",permalink:"/docs/reference/CHANGELOG"}},p=[{value:"Using Python Client",id:"using-python-client",children:[{value:"Install",id:"install",children:[],level:3},{value:"Initialize Python client",id:"initialize-python-client",children:[],level:3},{value:"Download predictions from NumerBay",id:"download-predictions-from-numerbay",children:[],level:3},{value:"Read downloaded predictions",id:"read-downloaded-predictions",children:[],level:3},{value:"Ensemble by simple average",id:"ensemble-by-simple-average",children:[],level:3}],level:2}],c={toc:p};function m(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"ensemble-with-numerbay"},"Ensemble with NumerBay"),(0,o.kt)("p",null,"In this tutorial we are going to make a simple ensemble Numerai predictions file from predictions bought on NumerBay."),(0,o.kt)("p",null,"Ensembling tends to lower variance and improve accuracy, and we want these for the Numerai tournaments."),(0,o.kt)("p",null,"Replace with your credentials below and change ",(0,o.kt)("inlineCode",{parentName:"p"},"products_to_ensemble")," to the full names of the prediction files you have bought on NumerBay.\nProducts you buy need to be listed in ",(0,o.kt)("inlineCode",{parentName:"p"},"File")," mode so that you can download the files."),(0,o.kt)("p",null,"A working example notebook for this tutorial is available at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/councilofelders/numerbay/blob/master/examples/NumerBay%20Ensemble%20Example.ipynb"},"https://github.com/councilofelders/numerbay/blob/master/examples/NumerBay%20Ensemble%20Example.ipynb")),(0,o.kt)("p",null,"Checkout the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/docs/reference/numerbay"},"Python Client Reference"))," docs to learn about all available methods, parameters and returned values."),(0,o.kt)("h2",{id:"using-python-client"},"Using Python Client"),(0,o.kt)("h3",{id:"install"},"Install"),(0,o.kt)("p",null,"If you have not installed the ",(0,o.kt)("inlineCode",{parentName:"p"},"numerbay")," client, install by:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-commandline"},"pip install -U numerbay\n")),(0,o.kt)("h3",{id:"initialize-python-client"},"Initialize Python client"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import pandas as pd\nfrom numerbay import NumerBay\n\napi = NumerBay(username="myusername", password="mypassword")\n\n# exported NumerBay key file used for decryption, optional\nnumerbay_key_path = \'./numerbay.json\'\n')),(0,o.kt)("h3",{id:"download-predictions-from-numerbay"},"Download predictions from NumerBay"),(0,o.kt)("p",null,"Assuming you bought two products: ",(0,o.kt)("inlineCode",{parentName:"p"},"numerai-predictions-numerbay")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"numerai-predictions-numerbay2")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'products_to_ensemble = ["numerai-predictions-numerbay", "numerai-predictions-numerbay2"]\n\nfor product_name in products_to_ensemble:\n    api.download_artifact(f"{product_name}.csv", product_full_name=product_name, key_path=numerbay_key_path)\n')),(0,o.kt)("h3",{id:"read-downloaded-predictions"},"Read downloaded predictions"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'all_preds = [pd.read_csv(f"{product_name}.csv", index_col=0).add_suffix(f"_{product_name}") \n             for product_name in products_to_ensemble]\n\nconcat_preds = pd.concat(all_preds, axis=1, names=products_to_ensemble).dropna(how=\'any\')\n# drop NaNs because one submission file is a legacy file and the other a v2 file\n')),(0,o.kt)("h3",{id:"ensemble-by-simple-average"},"Ensemble by simple average"),(0,o.kt)("p",null,"For demo purpose we do a simple average ensemble here. You can of course try other methods such as rank-averaged predictions, etc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"ensemble_preds = concat_preds.mean(axis=1).rename('prediction').to_frame()\nensemble_preds.to_csv('ensemble.csv')\n")))}m.isMDXComponent=!0}}]);